################
# Run in NGINX #
################
FROM nginx:latest

ARG ENVIRONMENT
ARG VERSION
ARG API_GATEWAY_PORT
ARG EUREKA_SERVER_PORT
ARG CONFIG_SERVER_PORT
ARG CONFIG_SERVER_SECURITY_NAME
ARG CONFIG_SERVER_SECURITY_PASS
ARG AUTHORIZATION_JWT_SECRET
ARG AUTHENTICATION_USER
ARG AUTHENTICATION_PASS
ARG PG_HOST_SERVER
ARG PG_HOST_SERVER_PORT
ARG PG_IMAGE_TAG
ARG PG_USER
ARG PG_PASS
ARG PG_DB_NAME
ARG PG_USER_ADMIN
ARG PG_PASS_ADMIN
ARG SQL_USER_NAME_1
ARG SQL_USER_NAME_2
ARG API_UI_PORT_EXT

ENV APP_VERSION $VERSION
ENV APP_ENVIRONMENT $ENVIRONMENT
ENV API_GATEWAY_PORT $API_GATEWAY_PORT
ENV EUREKA_SERVER_PORT $EUREKA_SERVER_PORT
ENV CONFIG_SERVER_PORT $CONFIG_SERVER_PORT
ENV CONFIG_SERVER_SECURITY_NAME $CONFIG_SERVER_SECURITY_NAME
ENV CONFIG_SERVER_SECURITY_PASS $CONFIG_SERVER_SECURITY_PASS
ENV AUTHORIZATION_JWT_SECRET $AUTHORIZATION_JWT_SECRET
ENV AUTHENTICATION_USER $AUTHENTICATION_USER
ENV AUTHENTICATION_PASS $AUTHENTICATION_PASS
ENV PG_HOST_SERVER $PG_HOST_SERVER
ENV PG_HOST_SERVER_PORT $PG_HOST_SERVER_PORT
ENV PG_IMAGE_TAG $PG_IMAGE_TAG
ENV PG_USER $PG_USER
ENV PG_PASS $PG_PASS
ENV PG_DB_NAME $PG_DB_NAME
ENV PG_USER_ADMIN $PG_USER_ADMIN
ENV PG_PASS_ADMIN $PG_PASS_ADMIN
ENV SQL_USER_NAME_1 $SQL_USER_NAME_1
ENV SQL_USER_NAME_2 $SQL_USER_NAME_2

#COPY nginx.conf /etc/nginx/conf.d/default.conf
#COPY dist/app-ui/* /usr/share/nginx/html

COPY nginx.conf  /etc/nginx/conf.d/default.conf
COPY dist/app-ui /usr/share/nginx/html

CMD ["/bin/sh",  "-c",  "envsubst < /usr/share/nginx/html/assets/env.template.js > /usr/share/nginx/html/assets/env.js && exec nginx -g 'daemon off;'"]
# Expose port 80
EXPOSE $API_UI_PORT_EXT
